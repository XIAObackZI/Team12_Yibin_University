<!-- components/layout/Navbar.html -->
<nav class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-b border-gray-200/30 dark:border-gray-700/30 fixed top-0 left-0 right-0 z-50 transition-colors duration-300" id="navbar">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">

            <!-- Left Section: Logo -->
            <div class="flex-shrink-0">
                <a href="/" class="flex items-center text-xl font-bold text-gray-800 dark:text-white title-font">
                    <i class="fas fa-pen-fancy text-indigo-600 dark:text-indigo-400 text-2xl mr-2"></i>
                    <span>TechBlog</span>
                </a>
            </div>

            <!-- Center Section: Desktop Navigation Links -->
            <div class="hidden md:flex flex-grow justify-center">
                <div class="flex items-baseline space-x-8">
                    <a href="/index.html" class="nav-link text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-base font-medium">
                        <i class="fas fa-home mr-1 opacity-80"></i>首页
                    </a>
                    <a href="/articles.html" class="nav-link text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-base font-medium">
                        <i class="fas fa-book-open mr-1 opacity-80"></i>文章
                    </a>
                    <a href="/index.html#categories-section" class="nav-link text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-base font-medium">
                        <i class="fas fa-tags mr-1 opacity-80"></i>分类
                    </a>
                    <a href="/index.html#team-section" class="nav-link text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-base font-medium">
                        <i class="fas fa-users mr-1 opacity-80"></i>开发团队
                    </a>
                    <a href="/index.html#contact" class="nav-link text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-base font-medium">
                        <i class="fas fa-envelope mr-1 opacity-80"></i>联系我们
                    </a>
                </div>
            </div>

            <!-- Right Section: Search, Theme, User, Mobile Menu -->
            <div class="flex items-center space-x-4">
                <!-- Search (Optional: Hidden on small screens if needed) -->
                <div class="relative hidden sm:block">
                     <input type="text" placeholder="搜索..." class="w-48 lg:w-64 px-4 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 border-transparent focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-sm transition">
                     <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                         <i class="fas fa-search text-xs"></i>
                     </button>
                </div>

                <!-- Notification -->
                <button id="notification-bell" class="hidden md:flex items-center justify-center p-2 rounded-full text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 dark:focus:ring-offset-gray-800 focus:ring-indigo-500 relative" onclick="toggleNotificationPanel(event)">
                    <span class="sr-only">查看通知</span>
                    <i class="far fa-bell text-lg"></i>
                    <span class="notification-badge absolute -top-1 -right-1 bg-red-500 text-white text-xs w-4 h-4 rounded-full flex items-center justify-center">3</span>
                </button>

                <!-- Notification Panel (Hidden by default) -->
                <div id="notification-panel" class="hidden fixed right-4 mt-16 top-0 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-xl py-2 z-50 transform origin-top-right transition-all duration-200 border border-gray-200 dark:border-gray-700">
                    <div class="px-4 py-2 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-700 rounded-t-lg">
                        <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-200">通知中心</h3>
                        <span class="text-xs text-gray-500 dark:text-gray-400 bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 px-2 py-1 rounded-full">3条未读</span>
                    </div>
                    <div class="max-h-64 overflow-y-auto">
                        <div class="border-l-4 border-blue-500 px-4 py-3 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <div class="flex items-start">
                                <img class="h-10 w-10 rounded-full mr-3" src="https://randomuser.me/api/portraits/men/41.jpg" alt="通知用户头像">
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white truncate">
                                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 mr-1">新消息</span>
                                        系统消息
                                    </p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">您的账户已成功激活，现在可以使用所有功能了。</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">3分钟前</p>
                                </div>
                            </div>
                        </div>
                        <div class="border-l-4 border-yellow-500 px-4 py-3 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <div class="flex items-start">
                                <img class="h-10 w-10 rounded-full mr-3" src="https://randomuser.me/api/portraits/women/67.jpg" alt="通知用户头像">
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white truncate">
                                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800 mr-1">提醒</span>
                                        张小明
                                    </p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">回复了您的评论: "非常感谢分享这个实用技巧！"</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">2小时前</p>
                                </div>
                            </div>
                        </div>
                        <div class="border-l-4 border-green-500 px-4 py-3 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <div class="flex items-start">
                                <img class="h-10 w-10 rounded-full mr-3" src="https://ui-avatars.com/api/?background=0D8ABC&color=fff&name=系统" alt="系统头像">
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white truncate">
                                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 mr-1">系统</span>
                                        更新通知
                                    </p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">网站将于今晚22:00-23:00进行例行维护，期间可能短暂无法访问。</p>
                                    <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">1天前</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="px-4 py-2 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700 rounded-b-lg">
                        <button id="mark-all-read" class="text-xs text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 font-medium" onclick="markAllNotificationsAsRead(event)">标记全部已读</button>
                    </div>
                </div>

                <!-- 添加通知音效 -->
                <audio id="notification-sound" preload="auto">
                    <source src="../../assets/sounds/mixkit-bell.wav" type="audio/wav">
                    <!-- 备用音效 -->
                    <source src="../../assets/sounds/notification.wav" type="audio/wav">
                </audio>

                <!-- Profile dropdown -->
                <div class="relative hidden md:block">
                    <button id="user-menu" class="flex text-sm bg-gray-200 dark:bg-gray-700 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 dark:focus:ring-offset-gray-800 focus:ring-indigo-500" aria-expanded="false" aria-haspopup="true">
                        <span class="sr-only">Open user menu</span>
                        <img class="h-8 w-8 rounded-full" src="https://randomuser.me/api/portraits/men/32.jpg" alt="用户头像">
                    </button>
                    <!-- Dropdown menu -->
                    <div id="dropdown-menu" class="hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="user-menu">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">个人资料</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">设置</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">退出</a>
                    </div>
                </div>

                 <!-- Mobile menu button -->
                 <div class="flex items-center md:hidden">
                    <button id="mobile-menu-button" type="button" aria-controls="mobile-menu" aria-expanded="false" style="width: 40px; height: 40px; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: rgba(0,0,0,0.05); border-radius: 8px; border: none; padding: 0;">
                        <span class="sr-only">打开主菜单</span>
                        <span style="display: block; width: 22px; height: 2px; background-color: #333; margin: 3px 0; border-radius: 1px;"></span>
                        <span style="display: block; width: 22px; height: 2px; background-color: #333; margin: 3px 0; border-radius: 1px;"></span>
                        <span style="display: block; width: 22px; height: 2px; background-color: #333; margin: 3px 0; border-radius: 1px;"></span>
                    </button>
                 </div>

            </div> <!-- End Right Section -->
        </div> <!-- End Flex Container -->
    </div> <!-- End Max Width Container -->

    <!-- Mobile menu, show/hide based on menu state. -->
    <div id="mobile-menu">
        <div class="mobile-menu-items">
            <a href="/index.html" class="mobile-menu-item current">
                <i class="fas fa-home"></i>
                <span>首页</span>
            </a>
            <a href="/articles.html" class="mobile-menu-item">
                <i class="fas fa-book-open"></i>
                <span>文章</span>
            </a>
            <a href="/index.html#categories-section" class="mobile-menu-item">
                <i class="fas fa-tags"></i>
                <span>分类</span>
            </a>
            <a href="/index.html#team-section" class="mobile-menu-item">
                <i class="fas fa-users"></i>
                <span>开发团队</span>
            </a>
            <a href="/index.html#contact" class="mobile-menu-item">
                <i class="fas fa-envelope"></i>
                <span>联系我们</span>
            </a>
            <a href="/presentation.html" class="mobile-menu-item">
                <i class="fas fa-desktop"></i>
                <span>演示</span>
            </a>
            <a href="#" class="mobile-menu-item">
                <i class="fas fa-info-circle"></i>
                <span>关于</span>
            </a>
            <a href="#" class="mobile-menu-item">
                <i class="fas fa-cog"></i>
                <span>设置</span>
            </a>
            <a href="#" class="mobile-menu-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>退出</span>
            </a>
        </div>
    </div>
</nav>

<style>
/* Styles for theme buttons (copied from previous version for consistency) */
.theme-button {
    @apply p-1 mr-1 rounded-full transition-transform duration-200 hover:scale-110 focus:outline-none w-6 h-6 flex items-center justify-center border-2 border-transparent; /* Fixed size, added mr-1 */
}
.theme-button:last-child {
    @apply mr-0; /* Remove margin from last button */
}
.theme-button.active {
     @apply ring-2 ring-offset-2 ring-offset-gray-100 dark:ring-offset-gray-800 ring-indigo-500 scale-110;
}
.dark-mode-toggle {
     @apply bg-gray-200 dark:bg-gray-600;
}
.dark-mode-toggle i {
    transition: color 0.3s ease;
    font-size: 1rem; /* Adjusted icon size */
    color: #6b7280; /* Default light mode icon color */
}
.dark-mode-toggle.active i {
    color: #fcd34d; /* Dark mode active icon color (sun) */
}

/* Mobile menu item base style */
.mobile-menu-item {
    @apply block rounded-md px-3 py-2 text-base font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white flex items-center;
}
.mobile-menu-item i {
    @apply mr-3 opacity-80;
}
/* Active mobile menu item style (Example) */
.mobile-menu-item.active {
     @apply bg-indigo-50 dark:bg-gray-700 text-indigo-700 dark:text-white;
}

/* 自定义移动菜单按钮样式 */
.mobile-menu-button {
    display: flex !important;
    position: relative;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    background-color: rgba(0, 0, 0, 0.05);
    align-items: center;
    justify-content: center;
    cursor: pointer;
}
.dark .mobile-menu-button {
    background-color: rgba(255, 255, 255, 0.1);
}
@media (min-width: 768px) {
    .mobile-menu-button {
        display: none !important;
    }
}
.mobile-menu-button .bar {
    display: block;
    position: absolute;
    width: 22px;
    height: 2px;
    background-color: #333;
    border-radius: 2px;
    left: 50%;
    transform: translateX(-50%);
    transition: all 0.3s;
}
.dark .mobile-menu-button .bar {
    background-color: #f1f5f9;
}
.mobile-menu-button .bar:nth-child(1) {
    top: 14px;
}
.mobile-menu-button .bar:nth-child(2) {
    top: 20px;
}
.mobile-menu-button .bar:nth-child(3) {
    top: 26px;
}
.mobile-menu-button.active .bar:nth-child(1) {
    top: 20px;
    transform: translateX(-50%) rotate(45deg);
}
.mobile-menu-button.active .bar:nth-child(2) {
    opacity: 0;
}
.mobile-menu-button.active .bar:nth-child(3) {
    top: 20px;
    transform: translateX(-50%) rotate(-45deg);
}

/* 通知徽章样式 */
.notification-badge {
    font-size: 0.6rem;
    line-height: 0.6rem;
}

/* Toast 消息样式 */
.toast-message {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
}

/* Commented out nav-link underline styles */
/*
.nav-link {
    position: relative;
    white-space: nowrap; 
}
.nav-link::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: -4px; 
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--color-primary, #6366f1); 
    transition: width 0.3s ease;
}
.nav-link:hover::after {
    width: 80%; 
}
*/

/* 添加铃铛震动动画 */
@keyframes bell-shake {
    0% { transform: rotate(0); }
    15% { transform: rotate(15deg); }
    30% { transform: rotate(-15deg); }
    45% { transform: rotate(12deg); }
    60% { transform: rotate(-12deg); }
    75% { transform: rotate(6deg); }
    85% { transform: rotate(-6deg); }
    92% { transform: rotate(3deg); }
    100% { transform: rotate(0); }
}

.animate-bell {
    animation: bell-shake 1s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
    transform-origin: top center;
}

/* 通知面板动画 */
#notification-panel {
    transition: opacity 0.3s ease, transform 0.3s ease;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

/* 通知徽章样式 */
.notification-badge {
    font-size: 0.6rem;
    line-height: 0.6rem;
    transition: all 0.3s ease;
}

/* Toast 消息样式 */
.toast-message {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
}
</style>

<script>
// 直接定义全局函数，不再依赖DOMContentLoaded事件
console.log('通知功能脚本已加载');

// 通知面板切换函数
function toggleNotificationPanel(e) {
    console.log('点击了通知铃铛 (全局函数)');
    e.stopPropagation();
    
    const notificationBell = document.getElementById('notification-bell');
    const notificationPanel = document.getElementById('notification-panel');
    const notificationSound = document.getElementById('notification-sound');
    
    if (!notificationPanel) {
        console.error('找不到通知面板元素!');
        return;
    }
    
    // 直接检查display属性，更可靠地判断可见性
    const isVisible = window.getComputedStyle(notificationPanel).display !== 'none';
    console.log('通知面板当前是否可见:', isVisible);
    
    if (isVisible) {
        console.log('隐藏通知面板');
        // 直接隐藏面板
        notificationPanel.classList.add('hidden');
    } else {
        console.log('显示通知面板');
        // 直接显示面板
        notificationPanel.classList.remove('hidden');
        
        // 震动铃铛图标效果
        const bellIcon = notificationBell.querySelector('i');
        if (bellIcon) {
            bellIcon.classList.add('animate-bell');
            setTimeout(() => {
                bellIcon.classList.remove('animate-bell');
            }, 1000);
        }
        
        // 改变徽章颜色
        const badge = notificationBell.querySelector('.notification-badge');
        if (badge) {
            badge.classList.add('bg-gray-500');
            badge.classList.remove('bg-red-500');
        }
        
        // 播放通知音效
        try {
            if (notificationSound) {
                notificationSound.currentTime = 0; // 重置播放位置
                notificationSound.volume = 0.5; // 设置音量为50%
                const playPromise = notificationSound.play();
                
                if (playPromise !== undefined) {
                    playPromise.catch(err => {
                        console.error('播放通知音效失败:', err);
                    });
                }
            } else {
                console.warn('未找到通知音效元素');
            }
        } catch (err) {
            console.error('播放通知音效时发生错误:', err);
        }
    }
}

// 标记全部已读函数
function markAllNotificationsAsRead(e) {
    console.log('点击了标记全部已读 (全局函数)');
    e.preventDefault();
    e.stopPropagation();
    
    const notificationBell = document.getElementById('notification-bell');
    const notificationPanel = document.getElementById('notification-panel');
    
    // 获取所有未读通知
    const notificationItems = notificationPanel.querySelectorAll('.border-l-4');
    console.log('找到未读通知数量:', notificationItems.length);
    
    // 动画移除未读标识
    notificationItems.forEach((item, index) => {
        setTimeout(() => {
            item.classList.add('transition-all', 'duration-300');
            item.classList.remove('border-l-4', 'border-blue-500', 'border-yellow-500', 'border-green-500');
            item.classList.add('border-l-0');
        }, index * 100); // 错开动画时间
    });
    
    // 移除通知徽章
    const badge = notificationBell.querySelector('.notification-badge');
    if (badge) {
        badge.classList.add('opacity-0', 'scale-0', 'transition-all', 'duration-300');
        setTimeout(() => {
            badge.remove();
        }, 300);
    }
    
    // 更新通知计数
    const countElement = notificationPanel.querySelector('.text-xs.text-gray-500:not(.hover\\:text-indigo-600)');
    if (countElement) {
        countElement.textContent = '0条未读';
        countElement.classList.remove('bg-red-100', 'text-red-600');
        countElement.classList.add('bg-gray-100', 'text-gray-600');
    }
    
    // 显示已读提示
    showToast('全部通知已标记为已读', 'success');
}

// 显示提示消息函数
function showToast(message, type = 'info') {
    // 如果已经存在toast，先移除
    const existingToast = document.querySelector('.toast-message');
    if (existingToast) {
        existingToast.remove();
    }
    
    // 创建toast元素
    const toast = document.createElement('div');
    toast.className = 'toast-message fixed right-5 top-20 px-4 py-2 rounded-lg shadow-lg z-50 transform transition-all duration-500 translate-x-full';
    
    // 设置toast类型样式
    if (type === 'success') {
        toast.classList.add('bg-green-500', 'text-white');
    } else if (type === 'error') {
        toast.classList.add('bg-red-500', 'text-white');
    } else if (type === 'warning') {
        toast.classList.add('bg-yellow-500', 'text-white');
    } else {
        toast.classList.add('bg-blue-500', 'text-white');
    }
    
    // 设置内容
    toast.innerHTML = `
        <div class="flex items-center">
            <i class="${type === 'success' ? 'fas fa-check-circle' : type === 'error' ? 'fas fa-exclamation-circle' : type === 'warning' ? 'fas fa-exclamation-triangle' : 'fas fa-info-circle'} mr-2"></i>
            <span>${message}</span>
        </div>
    `;
    
    // 添加到页面
    document.body.appendChild(toast);
    
    // 显示动画
    setTimeout(() => {
        toast.classList.remove('translate-x-full');
        toast.classList.add('translate-x-0');
    }, 10);
    
    // 自动隐藏
    setTimeout(() => {
        toast.classList.remove('translate-x-0');
        toast.classList.add('translate-x-full');
        setTimeout(() => {
            toast.remove();
        }, 500);
    }, 3000);
}

// 点击页面其他地方关闭通知面板
document.addEventListener('click', function(e) {
    const notificationPanel = document.getElementById('notification-panel');
    const notificationBell = document.getElementById('notification-bell');
    
    if (notificationPanel && !notificationPanel.classList.contains('hidden') && 
        !notificationPanel.contains(e.target) && !notificationBell.contains(e.target)) {
        console.log('点击了页面其他区域，关闭通知面板');
        notificationPanel.classList.add('hidden');
    }
});

// 初始化移动菜单按钮
document.addEventListener('DOMContentLoaded', function() {
    console.log('初始化导航栏移动菜单按钮');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuButton && mobileMenu) {
        console.log('找到移动菜单元素，添加事件监听');
        
        // 检查是否为深色模式并适配按钮颜色
        function updateButtonTheme() {
            const isDarkMode = document.documentElement.classList.contains('dark') || 
                                document.body.classList.contains('dark') ||
                                document.documentElement.getAttribute('data-theme') === 'dark';
            
            const bars = mobileMenuButton.querySelectorAll('span:not(.sr-only)');
            
            if (isDarkMode) {
                mobileMenuButton.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                bars.forEach(bar => {
                    bar.style.backgroundColor = '#f1f5f9'; // 浅色横线
                });
            } else {
                mobileMenuButton.style.backgroundColor = 'rgba(0, 0, 0, 0.05)';
                bars.forEach(bar => {
                    bar.style.backgroundColor = '#333333'; // 深色横线
                });
            }
        }
        
        // 初始化时调用一次
        updateButtonTheme();
        
        // 监听主题变化
        const observer = new MutationObserver(updateButtonTheme);
        observer.observe(document.documentElement, { 
            attributes: true,
            attributeFilter: ['class', 'data-theme']
        });
        observer.observe(document.body, { 
            attributes: true,
            attributeFilter: ['class'] 
        });
        
        mobileMenuButton.addEventListener('click', function() {
            console.log('点击移动菜单按钮');
            
            // 切换按钮激活状态视觉效果
            if (mobileMenuButton.getAttribute('aria-expanded') === 'true') {
                mobileMenuButton.setAttribute('aria-expanded', 'false');
                updateButtonTheme(); // 恢复正常背景色
                // 恢复三条线的样式
                const bars = mobileMenuButton.querySelectorAll('span:not(.sr-only)');
                bars.forEach((bar, index) => {
                    bar.style.transform = 'none';
                    bar.style.margin = '3px 0';
                    bar.style.opacity = '1';
                });
            } else {
                mobileMenuButton.setAttribute('aria-expanded', 'true');
                // 深色模式和浅色模式下的激活颜色
                const isDarkMode = document.documentElement.classList.contains('dark') || 
                                   document.body.classList.contains('dark') ||
                                   document.documentElement.getAttribute('data-theme') === 'dark';
                
                mobileMenuButton.style.backgroundColor = isDarkMode ? 'rgba(255, 255, 255, 0.15)' : 'rgba(0, 0, 0, 0.1)';
                
                // 设置X形状
                const bars = mobileMenuButton.querySelectorAll('span:not(.sr-only)');
                if (bars.length >= 3) {
                    bars[0].style.transform = 'translateY(5px) rotate(45deg)';
                    bars[0].style.margin = '0';
                    bars[1].style.opacity = '0';
                    bars[2].style.transform = 'translateY(-5px) rotate(-45deg)';
                    bars[2].style.margin = '0';
                }
            }
            
            // 切换菜单显示状态
            mobileMenu.classList.toggle('active');
            
            // 防止菜单打开时背景滚动
            const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
            if (isExpanded) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        });
        
        // 点击菜单项后自动关闭菜单
        const menuItems = mobileMenu.querySelectorAll('.mobile-menu-item');
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                mobileMenuButton.setAttribute('aria-expanded', 'false');
                updateButtonTheme(); // 恢复正常背景色
                mobileMenu.classList.remove('active');
                document.body.style.overflow = '';
                
                // 恢复三条线的样式
                const bars = mobileMenuButton.querySelectorAll('span:not(.sr-only)');
                bars.forEach((bar, index) => {
                    bar.style.transform = 'none';
                    bar.style.margin = '3px 0';
                    bar.style.opacity = '1';
                });
            });
        });
    } else {
        console.error('未找到移动菜单元素:',
            '按钮:', mobileMenuButton ? '存在' : '不存在',
            '菜单:', mobileMenu ? '存在' : '不存在');
    }
});

// 初始化时检查并记录元素是否存在
console.log('通知铃铛元素：', document.getElementById('notification-bell') ? '存在' : '不存在');
console.log('通知面板元素：', document.getElementById('notification-panel') ? '存在' : '不存在');
console.log('标记已读按钮：', document.getElementById('mark-all-read') ? '存在' : '不存在');
console.log('通知音效元素：', document.getElementById('notification-sound') ? '存在' : '不存在');
console.log('移动菜单按钮：', document.getElementById('mobile-menu-button') ? '存在' : '不存在');
</script> 